#!/usr/bin/env bash

# Abort on any error
set -Eeuo pipefail

declare DOCKER_USER
DOCKER_USER="$(id -u):$(id -g)"

DOCKER_USER=${DOCKER_USER} docker compose exec -T mysql mysql \
    -u"${HOOK_MOODLE_MYSQL_USER}" \
    -p"${HOOK_MOODLE_MYSQL_PASSWORD}" \
<<EOF
/* Add Hook webservice. */

START TRANSACTION;

USE \`${HOOK_MOODLE_MYSQL_DATABASE}\`;

/* Add Hook external service. */
DELETE FROM mdl_external_services WHERE id = 2;
INSERT INTO mdl_external_services VALUES(2, 'Hook', 1, '', 0, NULL, UNIX_TIMESTAMP(), NULL, 'Hook', 1, 1);

/* Link all available service functions with the Hook service. */
DELETE FROM mdl_external_services_functions WHERE externalserviceid = 2;
INSERT INTO mdl_external_services_functions VALUES
(NULL, 2, 'core_auth_confirm_user'),
(NULL, 2, 'core_auth_request_password_reset'),
(NULL, 2, 'core_auth_is_minor'),
(NULL, 2, 'core_auth_is_age_digital_consent_verification_enabled'),
(NULL, 2, 'core_auth_resend_confirmation_email'),
(NULL, 2, 'core_backup_get_async_backup_progress'),
(NULL, 2, 'core_backup_get_async_backup_links_backup'),
(NULL, 2, 'core_backup_get_async_backup_links_restore'),
(NULL, 2, 'core_backup_get_copy_progress'),
(NULL, 2, 'core_backup_submit_copy_form'),
(NULL, 2, 'core_badges_get_user_badges'),
(NULL, 2, 'core_blog_get_entries'),
(NULL, 2, 'core_blog_view_entries'),
(NULL, 2, 'core_calendar_get_calendar_monthly_view'),
(NULL, 2, 'core_calendar_get_calendar_day_view'),
(NULL, 2, 'core_calendar_get_calendar_upcoming_view'),
(NULL, 2, 'core_calendar_update_event_start_day'),
(NULL, 2, 'core_calendar_create_calendar_events'),
(NULL, 2, 'core_calendar_delete_calendar_events'),
(NULL, 2, 'core_calendar_get_calendar_events'),
(NULL, 2, 'core_calendar_get_action_events_by_timesort'),
(NULL, 2, 'core_calendar_get_action_events_by_course'),
(NULL, 2, 'core_calendar_get_action_events_by_courses'),
(NULL, 2, 'core_calendar_get_calendar_event_by_id'),
(NULL, 2, 'core_calendar_submit_create_update_form'),
(NULL, 2, 'core_calendar_get_calendar_access_information'),
(NULL, 2, 'core_calendar_get_allowed_event_types'),
(NULL, 2, 'core_calendar_get_timestamps'),
(NULL, 2, 'core_calendar_get_calendar_export_token'),
(NULL, 2, 'core_calendar_delete_subscription'),
(NULL, 2, 'core_cohort_add_cohort_members'),
(NULL, 2, 'core_cohort_create_cohorts'),
(NULL, 2, 'core_cohort_delete_cohort_members'),
(NULL, 2, 'core_cohort_delete_cohorts'),
(NULL, 2, 'core_cohort_get_cohort_members'),
(NULL, 2, 'core_cohort_search_cohorts'),
(NULL, 2, 'core_cohort_get_cohorts'),
(NULL, 2, 'core_cohort_update_cohorts'),
(NULL, 2, 'core_comment_get_comments'),
(NULL, 2, 'core_comment_add_comments'),
(NULL, 2, 'core_comment_delete_comments'),
(NULL, 2, 'core_completion_get_activities_completion_status'),
(NULL, 2, 'core_completion_get_course_completion_status'),
(NULL, 2, 'core_completion_mark_course_self_completed'),
(NULL, 2, 'core_completion_update_activity_completion_status_manually'),
(NULL, 2, 'core_completion_override_activity_completion_status'),
(NULL, 2, 'core_course_create_categories'),
(NULL, 2, 'core_course_create_courses'),
(NULL, 2, 'core_course_delete_categories'),
(NULL, 2, 'core_course_delete_courses'),
(NULL, 2, 'core_course_delete_modules'),
(NULL, 2, 'core_course_duplicate_course'),
(NULL, 2, 'core_course_get_categories'),
(NULL, 2, 'core_course_get_contents'),
(NULL, 2, 'core_course_get_course_module'),
(NULL, 2, 'core_course_get_course_module_by_instance'),
(NULL, 2, 'core_course_get_module'),
(NULL, 2, 'core_courseformat_get_state'),
(NULL, 2, 'core_courseformat_update_course'),
(NULL, 2, 'core_course_edit_module'),
(NULL, 2, 'core_course_edit_section'),
(NULL, 2, 'core_course_get_courses'),
(NULL, 2, 'core_course_import_course'),
(NULL, 2, 'core_course_search_courses'),
(NULL, 2, 'core_course_update_categories'),
(NULL, 2, 'core_course_update_courses'),
(NULL, 2, 'core_course_view_course'),
(NULL, 2, 'core_course_get_user_navigation_options'),
(NULL, 2, 'core_course_get_user_administration_options'),
(NULL, 2, 'core_course_get_courses_by_field'),
(NULL, 2, 'core_course_check_updates'),
(NULL, 2, 'core_course_get_updates_since'),
(NULL, 2, 'core_course_get_enrolled_courses_by_timeline_classification'),
(NULL, 2, 'core_course_get_enrolled_courses_with_action_events_by_timeline_classification'),
(NULL, 2, 'core_course_get_recent_courses'),
(NULL, 2, 'core_course_set_favourite_courses'),
(NULL, 2, 'core_course_get_enrolled_users_by_cmid'),
(NULL, 2, 'core_course_add_content_item_to_user_favourites'),
(NULL, 2, 'core_course_remove_content_item_from_user_favourites'),
(NULL, 2, 'core_course_get_course_content_items'),
(NULL, 2, 'core_course_get_activity_chooser_footer'),
(NULL, 2, 'core_course_toggle_activity_recommendation'),
(NULL, 2, 'core_enrol_get_course_enrolment_methods'),
(NULL, 2, 'core_enrol_get_enrolled_users'),
(NULL, 2, 'core_enrol_get_enrolled_users_with_capability'),
(NULL, 2, 'core_enrol_get_potential_users'),
(NULL, 2, 'core_enrol_search_users'),
(NULL, 2, 'core_enrol_get_users_courses'),
(NULL, 2, 'core_enrol_submit_user_enrolment_form'),
(NULL, 2, 'core_enrol_unenrol_user_enrolment'),
(NULL, 2, 'core_fetch_notifications'),
(NULL, 2, 'core_session_touch'),
(NULL, 2, 'core_session_time_remaining'),
(NULL, 2, 'core_files_get_files'),
(NULL, 2, 'core_files_upload'),
(NULL, 2, 'core_files_delete_draft_files'),
(NULL, 2, 'core_files_get_unused_draft_itemid'),
(NULL, 2, 'core_form_get_filetypes_browser_data'),
(NULL, 2, 'core_form_dynamic_form'),
(NULL, 2, 'core_get_component_strings'),
(NULL, 2, 'core_get_fragment'),
(NULL, 2, 'core_get_string'),
(NULL, 2, 'core_get_strings'),
(NULL, 2, 'core_get_user_dates'),
(NULL, 2, 'core_grades_update_grades'),
(NULL, 2, 'core_grades_grader_gradingpanel_point_fetch'),
(NULL, 2, 'core_grades_grader_gradingpanel_point_store'),
(NULL, 2, 'core_grades_grader_gradingpanel_scale_fetch'),
(NULL, 2, 'core_grades_grader_gradingpanel_scale_store'),
(NULL, 2, 'core_grades_create_gradecategory'),
(NULL, 2, 'core_grades_create_gradecategories'),
(NULL, 2, 'core_grades_get_enrolled_users_for_search_widget'),
(NULL, 2, 'core_grades_get_groups_for_search_widget'),
(NULL, 2, 'core_grading_get_definitions'),
(NULL, 2, 'core_grading_get_gradingform_instances'),
(NULL, 2, 'core_grading_save_definitions'),
(NULL, 2, 'core_group_add_group_members'),
(NULL, 2, 'core_group_assign_grouping'),
(NULL, 2, 'core_group_create_groupings'),
(NULL, 2, 'core_group_create_groups'),
(NULL, 2, 'core_group_delete_group_members'),
(NULL, 2, 'core_group_delete_groupings'),
(NULL, 2, 'core_group_delete_groups'),
(NULL, 2, 'core_group_get_activity_allowed_groups'),
(NULL, 2, 'core_group_get_activity_groupmode'),
(NULL, 2, 'core_group_get_course_groupings'),
(NULL, 2, 'core_group_get_course_groups'),
(NULL, 2, 'core_group_get_course_user_groups'),
(NULL, 2, 'core_group_get_group_members'),
(NULL, 2, 'core_group_get_groupings'),
(NULL, 2, 'core_group_get_groups'),
(NULL, 2, 'core_group_unassign_grouping'),
(NULL, 2, 'core_group_update_groupings'),
(NULL, 2, 'core_group_update_groups'),
(NULL, 2, 'core_message_mute_conversations'),
(NULL, 2, 'core_message_unmute_conversations'),
(NULL, 2, 'core_message_block_user'),
(NULL, 2, 'core_message_get_contact_requests'),
(NULL, 2, 'core_message_create_contact_request'),
(NULL, 2, 'core_message_confirm_contact_request'),
(NULL, 2, 'core_message_decline_contact_request'),
(NULL, 2, 'core_message_get_received_contact_requests_count'),
(NULL, 2, 'core_message_delete_contacts'),
(NULL, 2, 'core_message_delete_conversations_by_id'),
(NULL, 2, 'core_message_delete_message'),
(NULL, 2, 'core_message_get_blocked_users'),
(NULL, 2, 'core_message_data_for_messagearea_search_messages'),
(NULL, 2, 'core_message_message_search_users'),
(NULL, 2, 'core_message_get_user_contacts'),
(NULL, 2, 'core_message_get_conversations'),
(NULL, 2, 'core_message_get_conversation'),
(NULL, 2, 'core_message_get_conversation_between_users'),
(NULL, 2, 'core_message_get_self_conversation'),
(NULL, 2, 'core_message_get_messages'),
(NULL, 2, 'core_message_get_conversation_counts'),
(NULL, 2, 'core_message_get_unread_conversation_counts'),
(NULL, 2, 'core_message_get_conversation_members'),
(NULL, 2, 'core_message_get_member_info'),
(NULL, 2, 'core_message_get_unread_conversations_count'),
(NULL, 2, 'core_message_mark_all_notifications_as_read'),
(NULL, 2, 'core_message_mark_all_conversation_messages_as_read'),
(NULL, 2, 'core_message_mark_message_read'),
(NULL, 2, 'core_message_mark_notification_read'),
(NULL, 2, 'core_message_message_processor_config_form'),
(NULL, 2, 'core_message_get_message_processor'),
(NULL, 2, 'core_message_search_contacts'),
(NULL, 2, 'core_message_send_instant_messages'),
(NULL, 2, 'core_message_send_messages_to_conversation'),
(NULL, 2, 'core_message_get_conversation_messages'),
(NULL, 2, 'core_message_unblock_user'),
(NULL, 2, 'core_message_get_user_notification_preferences'),
(NULL, 2, 'core_message_get_user_message_preferences'),
(NULL, 2, 'core_message_set_favourite_conversations'),
(NULL, 2, 'core_message_unset_favourite_conversations'),
(NULL, 2, 'core_message_delete_message_for_all_users'),
(NULL, 2, 'core_message_get_unread_notification_count'),
(NULL, 2, 'core_notes_create_notes'),
(NULL, 2, 'core_notes_delete_notes'),
(NULL, 2, 'core_notes_get_course_notes'),
(NULL, 2, 'core_notes_get_notes'),
(NULL, 2, 'core_notes_update_notes'),
(NULL, 2, 'core_notes_view_notes'),
(NULL, 2, 'core_output_load_template'),
(NULL, 2, 'core_output_load_template_with_dependencies'),
(NULL, 2, 'core_output_load_fontawesome_icon_map'),
(NULL, 2, 'core_output_load_fontawesome_icon_system_map'),
(NULL, 2, 'core_question_update_flag'),
(NULL, 2, 'core_question_submit_tags_form'),
(NULL, 2, 'core_question_get_random_question_summaries'),
(NULL, 2, 'core_rating_get_item_ratings'),
(NULL, 2, 'core_rating_add_rating'),
(NULL, 2, 'core_role_assign_roles'),
(NULL, 2, 'core_role_unassign_roles'),
(NULL, 2, 'core_search_get_relevant_users'),
(NULL, 2, 'core_tag_get_tagindex'),
(NULL, 2, 'core_tag_get_tags'),
(NULL, 2, 'core_tag_update_tags'),
(NULL, 2, 'core_tag_get_tagindex_per_area'),
(NULL, 2, 'core_tag_get_tag_areas'),
(NULL, 2, 'core_tag_get_tag_collections'),
(NULL, 2, 'core_tag_get_tag_cloud'),
(NULL, 2, 'core_update_inplace_editable'),
(NULL, 2, 'core_user_add_user_device'),
(NULL, 2, 'core_user_update_user_device_public_key'),
(NULL, 2, 'core_user_add_user_private_files'),
(NULL, 2, 'core_user_create_users'),
(NULL, 2, 'core_user_delete_users'),
(NULL, 2, 'core_user_get_course_user_profiles'),
(NULL, 2, 'core_user_get_users'),
(NULL, 2, 'core_user_get_users_by_field'),
(NULL, 2, 'core_user_search_identity'),
(NULL, 2, 'core_user_remove_user_device'),
(NULL, 2, 'core_user_update_users'),
(NULL, 2, 'core_user_update_user_preferences'),
(NULL, 2, 'core_user_view_user_list'),
(NULL, 2, 'core_user_view_user_profile'),
(NULL, 2, 'core_user_get_user_preferences'),
(NULL, 2, 'core_user_update_picture'),
(NULL, 2, 'core_user_set_user_preferences'),
(NULL, 2, 'core_user_agree_site_policy'),
(NULL, 2, 'core_user_get_private_files_info'),
(NULL, 2, 'core_competency_create_competency_framework'),
(NULL, 2, 'core_competency_read_competency_framework'),
(NULL, 2, 'core_competency_duplicate_competency_framework'),
(NULL, 2, 'core_competency_delete_competency_framework'),
(NULL, 2, 'core_competency_update_competency_framework'),
(NULL, 2, 'core_competency_list_competency_frameworks'),
(NULL, 2, 'core_competency_count_competency_frameworks'),
(NULL, 2, 'core_competency_competency_framework_viewed'),
(NULL, 2, 'core_competency_create_competency'),
(NULL, 2, 'core_competency_read_competency'),
(NULL, 2, 'core_competency_competency_viewed'),
(NULL, 2, 'core_competency_delete_competency'),
(NULL, 2, 'core_competency_update_competency'),
(NULL, 2, 'core_competency_list_competencies'),
(NULL, 2, 'core_competency_list_competencies_in_template'),
(NULL, 2, 'core_competency_count_competencies'),
(NULL, 2, 'core_competency_count_competencies_in_template'),
(NULL, 2, 'core_competency_search_competencies'),
(NULL, 2, 'core_competency_set_parent_competency'),
(NULL, 2, 'core_competency_move_up_competency'),
(NULL, 2, 'core_competency_move_down_competency'),
(NULL, 2, 'core_competency_list_course_module_competencies'),
(NULL, 2, 'core_competency_count_course_module_competencies'),
(NULL, 2, 'core_competency_list_course_competencies'),
(NULL, 2, 'core_competency_count_competencies_in_course'),
(NULL, 2, 'core_competency_count_courses_using_competency'),
(NULL, 2, 'core_competency_add_competency_to_course'),
(NULL, 2, 'core_competency_add_competency_to_template'),
(NULL, 2, 'core_competency_remove_competency_from_course'),
(NULL, 2, 'core_competency_set_course_competency_ruleoutcome'),
(NULL, 2, 'core_competency_remove_competency_from_template'),
(NULL, 2, 'core_competency_reorder_course_competency'),
(NULL, 2, 'core_competency_reorder_template_competency'),
(NULL, 2, 'core_competency_create_template'),
(NULL, 2, 'core_competency_duplicate_template'),
(NULL, 2, 'core_competency_read_template'),
(NULL, 2, 'core_competency_delete_template'),
(NULL, 2, 'core_competency_update_template'),
(NULL, 2, 'core_competency_list_templates'),
(NULL, 2, 'core_competency_list_templates_using_competency'),
(NULL, 2, 'core_competency_count_templates'),
(NULL, 2, 'core_competency_count_templates_using_competency'),
(NULL, 2, 'core_competency_create_plan'),
(NULL, 2, 'core_competency_update_plan'),
(NULL, 2, 'core_competency_complete_plan'),
(NULL, 2, 'core_competency_reopen_plan'),
(NULL, 2, 'core_competency_read_plan'),
(NULL, 2, 'core_competency_delete_plan'),
(NULL, 2, 'core_competency_list_user_plans'),
(NULL, 2, 'core_competency_list_plan_competencies'),
(NULL, 2, 'core_competency_add_competency_to_plan'),
(NULL, 2, 'core_competency_remove_competency_from_plan'),
(NULL, 2, 'core_competency_reorder_plan_competency'),
(NULL, 2, 'core_competency_plan_request_review'),
(NULL, 2, 'core_competency_plan_start_review'),
(NULL, 2, 'core_competency_plan_stop_review'),
(NULL, 2, 'core_competency_plan_cancel_review_request'),
(NULL, 2, 'core_competency_approve_plan'),
(NULL, 2, 'core_competency_unapprove_plan'),
(NULL, 2, 'core_competency_template_has_related_data'),
(NULL, 2, 'core_competency_get_scale_values'),
(NULL, 2, 'core_competency_add_related_competency'),
(NULL, 2, 'core_competency_remove_related_competency'),
(NULL, 2, 'core_competency_read_user_evidence'),
(NULL, 2, 'core_competency_delete_user_evidence'),
(NULL, 2, 'core_competency_create_user_evidence_competency'),
(NULL, 2, 'core_competency_delete_user_evidence_competency'),
(NULL, 2, 'core_competency_user_competency_cancel_review_request'),
(NULL, 2, 'core_competency_user_competency_request_review'),
(NULL, 2, 'core_competency_user_competency_start_review'),
(NULL, 2, 'core_competency_user_competency_stop_review'),
(NULL, 2, 'core_competency_user_competency_viewed'),
(NULL, 2, 'core_competency_user_competency_viewed_in_plan'),
(NULL, 2, 'core_competency_user_competency_viewed_in_course'),
(NULL, 2, 'core_competency_user_competency_plan_viewed'),
(NULL, 2, 'core_competency_grade_competency'),
(NULL, 2, 'core_competency_grade_competency_in_plan'),
(NULL, 2, 'core_competency_grade_competency_in_course'),
(NULL, 2, 'core_competency_unlink_plan_from_template'),
(NULL, 2, 'core_competency_template_viewed'),
(NULL, 2, 'core_competency_request_review_of_user_evidence_linked_competencies'),
(NULL, 2, 'core_competency_update_course_competency_settings'),
(NULL, 2, 'core_competency_delete_evidence'),
(NULL, 2, 'core_webservice_get_site_info'),
(NULL, 2, 'core_block_get_course_blocks'),
(NULL, 2, 'core_block_get_dashboard_blocks'),
(NULL, 2, 'core_block_fetch_addable_blocks'),
(NULL, 2, 'core_filters_get_available_in_context'),
(NULL, 2, 'core_customfield_delete_field'),
(NULL, 2, 'core_customfield_reload_template'),
(NULL, 2, 'core_customfield_create_category'),
(NULL, 2, 'core_customfield_delete_category'),
(NULL, 2, 'core_customfield_move_field'),
(NULL, 2, 'core_customfield_move_category'),
(NULL, 2, 'core_h5p_get_trusted_h5p_file'),
(NULL, 2, 'core_table_get_dynamic_table_content'),
(NULL, 2, 'core_xapi_statement_post'),
(NULL, 2, 'core_contentbank_delete_content'),
(NULL, 2, 'core_contentbank_rename_content'),
(NULL, 2, 'core_contentbank_set_content_visibility'),
(NULL, 2, 'core_create_userfeedback_action_record'),
(NULL, 2, 'core_payment_get_available_gateways'),
(NULL, 2, 'core_reportbuilder_filters_reset'),
(NULL, 2, 'core_reportbuilder_set_filters'),
(NULL, 2, 'core_dynamic_tabs_get_content'),
(NULL, 2, 'core_change_editmode'),
(NULL, 2, 'core_reportbuilder_reports_delete'),
(NULL, 2, 'core_reportbuilder_reports_get'),
(NULL, 2, 'core_reportbuilder_list_reports'),
(NULL, 2, 'core_reportbuilder_retrieve_report'),
(NULL, 2, 'core_reportbuilder_view_report'),
(NULL, 2, 'core_reportbuilder_columns_add'),
(NULL, 2, 'core_reportbuilder_columns_delete'),
(NULL, 2, 'core_reportbuilder_columns_reorder'),
(NULL, 2, 'core_reportbuilder_columns_sort_get'),
(NULL, 2, 'core_reportbuilder_columns_sort_reorder'),
(NULL, 2, 'core_reportbuilder_columns_sort_toggle'),
(NULL, 2, 'core_reportbuilder_conditions_add'),
(NULL, 2, 'core_reportbuilder_conditions_delete'),
(NULL, 2, 'core_reportbuilder_conditions_reorder'),
(NULL, 2, 'core_reportbuilder_conditions_reset'),
(NULL, 2, 'core_reportbuilder_filters_add'),
(NULL, 2, 'core_reportbuilder_filters_delete'),
(NULL, 2, 'core_reportbuilder_filters_reorder'),
(NULL, 2, 'core_reportbuilder_audiences_delete'),
(NULL, 2, 'core_reportbuilder_schedules_delete'),
(NULL, 2, 'core_reportbuilder_schedules_send'),
(NULL, 2, 'core_reportbuilder_schedules_toggle'),
(NULL, 2, 'mod_assign_copy_previous_attempt'),
(NULL, 2, 'mod_assign_get_grades'),
(NULL, 2, 'mod_assign_get_assignments'),
(NULL, 2, 'mod_assign_get_submissions'),
(NULL, 2, 'mod_assign_get_user_flags'),
(NULL, 2, 'mod_assign_set_user_flags'),
(NULL, 2, 'mod_assign_get_user_mappings'),
(NULL, 2, 'mod_assign_revert_submissions_to_draft'),
(NULL, 2, 'mod_assign_lock_submissions'),
(NULL, 2, 'mod_assign_unlock_submissions'),
(NULL, 2, 'mod_assign_save_submission'),
(NULL, 2, 'mod_assign_submit_for_grading'),
(NULL, 2, 'mod_assign_save_grade'),
(NULL, 2, 'mod_assign_save_grades'),
(NULL, 2, 'mod_assign_save_user_extensions'),
(NULL, 2, 'mod_assign_reveal_identities'),
(NULL, 2, 'mod_assign_view_grading_table'),
(NULL, 2, 'mod_assign_view_submission_status'),
(NULL, 2, 'mod_assign_get_submission_status'),
(NULL, 2, 'mod_assign_list_participants'),
(NULL, 2, 'mod_assign_submit_grading_form'),
(NULL, 2, 'mod_assign_get_participant'),
(NULL, 2, 'mod_assign_view_assign'),
(NULL, 2, 'mod_assign_start_submission'),
(NULL, 2, 'mod_bigbluebuttonbn_can_join'),
(NULL, 2, 'mod_bigbluebuttonbn_get_recordings'),
(NULL, 2, 'mod_bigbluebuttonbn_get_recordings_to_import'),
(NULL, 2, 'mod_bigbluebuttonbn_update_recording'),
(NULL, 2, 'mod_bigbluebuttonbn_end_meeting'),
(NULL, 2, 'mod_bigbluebuttonbn_completion_validate'),
(NULL, 2, 'mod_bigbluebuttonbn_meeting_info'),
(NULL, 2, 'mod_bigbluebuttonbn_get_bigbluebuttonbns_by_courses'),
(NULL, 2, 'mod_bigbluebuttonbn_view_bigbluebuttonbn'),
(NULL, 2, 'mod_bigbluebuttonbn_get_join_url'),
(NULL, 2, 'mod_book_view_book'),
(NULL, 2, 'mod_book_get_books_by_courses'),
(NULL, 2, 'mod_chat_login_user'),
(NULL, 2, 'mod_chat_get_chat_users'),
(NULL, 2, 'mod_chat_send_chat_message'),
(NULL, 2, 'mod_chat_get_chat_latest_messages'),
(NULL, 2, 'mod_chat_view_chat'),
(NULL, 2, 'mod_chat_get_chats_by_courses'),
(NULL, 2, 'mod_chat_get_sessions'),
(NULL, 2, 'mod_chat_get_session_messages'),
(NULL, 2, 'mod_choice_get_choice_results'),
(NULL, 2, 'mod_choice_get_choice_options'),
(NULL, 2, 'mod_choice_submit_choice_response'),
(NULL, 2, 'mod_choice_view_choice'),
(NULL, 2, 'mod_choice_get_choices_by_courses'),
(NULL, 2, 'mod_choice_delete_choice_responses'),
(NULL, 2, 'mod_data_get_databases_by_courses'),
(NULL, 2, 'mod_data_view_database'),
(NULL, 2, 'mod_data_get_data_access_information'),
(NULL, 2, 'mod_data_get_entries'),
(NULL, 2, 'mod_data_get_entry'),
(NULL, 2, 'mod_data_get_fields'),
(NULL, 2, 'mod_data_search_entries'),
(NULL, 2, 'mod_data_approve_entry'),
(NULL, 2, 'mod_data_delete_entry'),
(NULL, 2, 'mod_data_add_entry'),
(NULL, 2, 'mod_data_update_entry'),
(NULL, 2, 'mod_data_delete_saved_preset'),
(NULL, 2, 'mod_data_get_mapping_information'),
(NULL, 2, 'mod_feedback_get_feedbacks_by_courses'),
(NULL, 2, 'mod_feedback_get_feedback_access_information'),
(NULL, 2, 'mod_feedback_view_feedback'),
(NULL, 2, 'mod_feedback_get_current_completed_tmp'),
(NULL, 2, 'mod_feedback_get_items'),
(NULL, 2, 'mod_feedback_launch_feedback'),
(NULL, 2, 'mod_feedback_get_page_items'),
(NULL, 2, 'mod_feedback_process_page'),
(NULL, 2, 'mod_feedback_get_analysis'),
(NULL, 2, 'mod_feedback_get_unfinished_responses'),
(NULL, 2, 'mod_feedback_get_finished_responses'),
(NULL, 2, 'mod_feedback_get_non_respondents'),
(NULL, 2, 'mod_feedback_get_responses_analysis'),
(NULL, 2, 'mod_feedback_get_last_completed'),
(NULL, 2, 'mod_folder_view_folder'),
(NULL, 2, 'mod_folder_get_folders_by_courses'),
(NULL, 2, 'mod_forum_get_forums_by_courses'),
(NULL, 2, 'mod_forum_get_discussion_posts'),
(NULL, 2, 'mod_forum_get_forum_discussions_paginated'),
(NULL, 2, 'mod_forum_get_forum_discussions'),
(NULL, 2, 'mod_forum_view_forum'),
(NULL, 2, 'mod_forum_view_forum_discussion'),
(NULL, 2, 'mod_forum_add_discussion_post'),
(NULL, 2, 'mod_forum_add_discussion'),
(NULL, 2, 'mod_forum_can_add_discussion'),
(NULL, 2, 'mod_forum_get_forum_access_information'),
(NULL, 2, 'mod_forum_set_subscription_state'),
(NULL, 2, 'mod_forum_set_lock_state'),
(NULL, 2, 'mod_forum_toggle_favourite_state'),
(NULL, 2, 'mod_forum_set_pin_state'),
(NULL, 2, 'mod_forum_delete_post'),
(NULL, 2, 'mod_forum_get_discussion_posts_by_userid'),
(NULL, 2, 'mod_forum_get_discussion_post'),
(NULL, 2, 'mod_forum_prepare_draft_area_for_post'),
(NULL, 2, 'mod_forum_update_discussion_post'),
(NULL, 2, 'mod_glossary_get_glossaries_by_courses'),
(NULL, 2, 'mod_glossary_view_glossary'),
(NULL, 2, 'mod_glossary_view_entry'),
(NULL, 2, 'mod_glossary_get_entries_by_letter'),
(NULL, 2, 'mod_glossary_get_entries_by_date'),
(NULL, 2, 'mod_glossary_get_categories'),
(NULL, 2, 'mod_glossary_get_entries_by_category'),
(NULL, 2, 'mod_glossary_get_authors'),
(NULL, 2, 'mod_glossary_get_entries_by_author'),
(NULL, 2, 'mod_glossary_get_entries_by_author_id'),
(NULL, 2, 'mod_glossary_get_entries_by_search'),
(NULL, 2, 'mod_glossary_get_entries_by_term'),
(NULL, 2, 'mod_glossary_get_entries_to_approve'),
(NULL, 2, 'mod_glossary_get_entry_by_id'),
(NULL, 2, 'mod_glossary_add_entry'),
(NULL, 2, 'mod_glossary_delete_entry'),
(NULL, 2, 'mod_glossary_update_entry'),
(NULL, 2, 'mod_glossary_prepare_entry_for_edition'),
(NULL, 2, 'mod_h5pactivity_get_h5pactivity_access_information'),
(NULL, 2, 'mod_h5pactivity_view_h5pactivity'),
(NULL, 2, 'mod_h5pactivity_get_attempts'),
(NULL, 2, 'mod_h5pactivity_get_results'),
(NULL, 2, 'mod_h5pactivity_get_h5pactivities_by_courses'),
(NULL, 2, 'mod_h5pactivity_log_report_viewed'),
(NULL, 2, 'mod_h5pactivity_get_user_attempts'),
(NULL, 2, 'mod_imscp_view_imscp'),
(NULL, 2, 'mod_imscp_get_imscps_by_courses'),
(NULL, 2, 'mod_label_get_labels_by_courses'),
(NULL, 2, 'mod_lesson_get_lessons_by_courses'),
(NULL, 2, 'mod_lesson_get_lesson_access_information'),
(NULL, 2, 'mod_lesson_view_lesson'),
(NULL, 2, 'mod_lesson_get_questions_attempts'),
(NULL, 2, 'mod_lesson_get_user_grade'),
(NULL, 2, 'mod_lesson_get_user_attempt_grade'),
(NULL, 2, 'mod_lesson_get_content_pages_viewed'),
(NULL, 2, 'mod_lesson_get_user_timers'),
(NULL, 2, 'mod_lesson_get_pages'),
(NULL, 2, 'mod_lesson_launch_attempt'),
(NULL, 2, 'mod_lesson_get_page_data'),
(NULL, 2, 'mod_lesson_process_page'),
(NULL, 2, 'mod_lesson_finish_attempt'),
(NULL, 2, 'mod_lesson_get_attempts_overview'),
(NULL, 2, 'mod_lesson_get_user_attempt'),
(NULL, 2, 'mod_lesson_get_pages_possible_jumps'),
(NULL, 2, 'mod_lesson_get_lesson'),
(NULL, 2, 'mod_lti_get_tool_launch_data'),
(NULL, 2, 'mod_lti_get_ltis_by_courses'),
(NULL, 2, 'mod_lti_view_lti'),
(NULL, 2, 'mod_lti_get_tool_proxies'),
(NULL, 2, 'mod_lti_create_tool_proxy'),
(NULL, 2, 'mod_lti_delete_tool_proxy'),
(NULL, 2, 'mod_lti_get_tool_proxy_registration_request'),
(NULL, 2, 'mod_lti_get_tool_types'),
(NULL, 2, 'mod_lti_get_tool_types_and_proxies'),
(NULL, 2, 'mod_lti_get_tool_types_and_proxies_count'),
(NULL, 2, 'mod_lti_create_tool_type'),
(NULL, 2, 'mod_lti_update_tool_type'),
(NULL, 2, 'mod_lti_delete_tool_type'),
(NULL, 2, 'mod_lti_is_cartridge'),
(NULL, 2, 'mod_page_view_page'),
(NULL, 2, 'mod_page_get_pages_by_courses'),
(NULL, 2, 'mod_quiz_get_quizzes_by_courses'),
(NULL, 2, 'mod_quiz_view_quiz'),
(NULL, 2, 'mod_quiz_get_user_attempts'),
(NULL, 2, 'mod_quiz_get_user_best_grade'),
(NULL, 2, 'mod_quiz_get_combined_review_options'),
(NULL, 2, 'mod_quiz_start_attempt'),
(NULL, 2, 'mod_quiz_get_attempt_data'),
(NULL, 2, 'mod_quiz_get_attempt_summary'),
(NULL, 2, 'mod_quiz_save_attempt'),
(NULL, 2, 'mod_quiz_process_attempt'),
(NULL, 2, 'mod_quiz_get_attempt_review'),
(NULL, 2, 'mod_quiz_view_attempt'),
(NULL, 2, 'mod_quiz_view_attempt_summary'),
(NULL, 2, 'mod_quiz_view_attempt_review'),
(NULL, 2, 'mod_quiz_get_quiz_feedback_for_grade'),
(NULL, 2, 'mod_quiz_get_quiz_access_information'),
(NULL, 2, 'mod_quiz_get_attempt_access_information'),
(NULL, 2, 'mod_quiz_get_quiz_required_qtypes'),
(NULL, 2, 'mod_quiz_set_question_version'),
(NULL, 2, 'mod_resource_view_resource'),
(NULL, 2, 'mod_resource_get_resources_by_courses'),
(NULL, 2, 'mod_scorm_view_scorm'),
(NULL, 2, 'mod_scorm_get_scorm_attempt_count'),
(NULL, 2, 'mod_scorm_get_scorm_scoes'),
(NULL, 2, 'mod_scorm_get_scorm_user_data'),
(NULL, 2, 'mod_scorm_insert_scorm_tracks'),
(NULL, 2, 'mod_scorm_get_scorm_sco_tracks'),
(NULL, 2, 'mod_scorm_get_scorms_by_courses'),
(NULL, 2, 'mod_scorm_launch_sco'),
(NULL, 2, 'mod_scorm_get_scorm_access_information'),
(NULL, 2, 'mod_survey_get_surveys_by_courses'),
(NULL, 2, 'mod_survey_view_survey'),
(NULL, 2, 'mod_survey_get_questions'),
(NULL, 2, 'mod_survey_submit_answers'),
(NULL, 2, 'mod_url_view_url'),
(NULL, 2, 'mod_url_get_urls_by_courses'),
(NULL, 2, 'mod_wiki_get_wikis_by_courses'),
(NULL, 2, 'mod_wiki_view_wiki'),
(NULL, 2, 'mod_wiki_view_page'),
(NULL, 2, 'mod_wiki_get_subwikis'),
(NULL, 2, 'mod_wiki_get_subwiki_pages'),
(NULL, 2, 'mod_wiki_get_subwiki_files'),
(NULL, 2, 'mod_wiki_get_page_contents'),
(NULL, 2, 'mod_wiki_get_page_for_editing'),
(NULL, 2, 'mod_wiki_new_page'),
(NULL, 2, 'mod_wiki_edit_page'),
(NULL, 2, 'mod_workshop_get_workshops_by_courses'),
(NULL, 2, 'mod_workshop_get_workshop_access_information'),
(NULL, 2, 'mod_workshop_get_user_plan'),
(NULL, 2, 'mod_workshop_view_workshop'),
(NULL, 2, 'mod_workshop_add_submission'),
(NULL, 2, 'mod_workshop_update_submission'),
(NULL, 2, 'mod_workshop_delete_submission'),
(NULL, 2, 'mod_workshop_get_submissions'),
(NULL, 2, 'mod_workshop_get_submission'),
(NULL, 2, 'mod_workshop_get_submission_assessments'),
(NULL, 2, 'mod_workshop_get_assessment'),
(NULL, 2, 'mod_workshop_get_assessment_form_definition'),
(NULL, 2, 'mod_workshop_get_reviewer_assessments'),
(NULL, 2, 'mod_workshop_update_assessment'),
(NULL, 2, 'mod_workshop_get_grades'),
(NULL, 2, 'mod_workshop_evaluate_assessment'),
(NULL, 2, 'mod_workshop_get_grades_report'),
(NULL, 2, 'mod_workshop_view_submission'),
(NULL, 2, 'mod_workshop_evaluate_submission'),
(NULL, 2, 'auth_email_get_signup_settings'),
(NULL, 2, 'auth_email_signup_user'),
(NULL, 2, 'enrol_guest_get_instance_info'),
(NULL, 2, 'enrol_manual_enrol_users'),
(NULL, 2, 'enrol_manual_unenrol_users'),
(NULL, 2, 'enrol_meta_add_instances'),
(NULL, 2, 'enrol_meta_delete_instances'),
(NULL, 2, 'enrol_self_get_instance_info'),
(NULL, 2, 'enrol_self_enrol_user'),
(NULL, 2, 'message_airnotifier_is_system_configured'),
(NULL, 2, 'message_airnotifier_are_notification_preferences_configured'),
(NULL, 2, 'message_airnotifier_get_user_devices'),
(NULL, 2, 'message_airnotifier_enable_device'),
(NULL, 2, 'message_popup_get_popup_notifications'),
(NULL, 2, 'message_popup_get_unread_popup_notification_count'),
(NULL, 2, 'block_accessreview_get_module_data'),
(NULL, 2, 'block_accessreview_get_section_data'),
(NULL, 2, 'block_recentlyaccesseditems_get_recent_items'),
(NULL, 2, 'block_starredcourses_get_starred_courses'),
(NULL, 2, 'media_videojs_get_language'),
(NULL, 2, 'report_competency_data_for_report'),
(NULL, 2, 'report_insights_set_notuseful_prediction'),
(NULL, 2, 'report_insights_set_fixed_prediction'),
(NULL, 2, 'report_insights_action_executed'),
(NULL, 2, 'gradereport_overview_get_course_grades'),
(NULL, 2, 'gradereport_overview_view_grade_report'),
(NULL, 2, 'gradereport_singleview_get_grade_items_for_search_widget'),
(NULL, 2, 'gradereport_user_get_grades_table'),
(NULL, 2, 'gradereport_user_view_grade_report'),
(NULL, 2, 'gradereport_user_get_grade_items'),
(NULL, 2, 'gradingform_guide_grader_gradingpanel_fetch'),
(NULL, 2, 'gradingform_guide_grader_gradingpanel_store'),
(NULL, 2, 'gradingform_rubric_grader_gradingpanel_fetch'),
(NULL, 2, 'gradingform_rubric_grader_gradingpanel_store'),
(NULL, 2, 'qbank_columnsortorder_set_columnbank_order'),
(NULL, 2, 'qbank_editquestion_set_status'),
(NULL, 2, 'qbank_tagquestion_submit_tags_form'),
(NULL, 2, 'tool_analytics_potential_contexts'),
(NULL, 2, 'tool_behat_get_entity_generator'),
(NULL, 2, 'tool_dataprivacy_cancel_data_request'),
(NULL, 2, 'tool_dataprivacy_contact_dpo'),
(NULL, 2, 'tool_dataprivacy_mark_complete'),
(NULL, 2, 'tool_dataprivacy_get_data_request'),
(NULL, 2, 'tool_dataprivacy_approve_data_request'),
(NULL, 2, 'tool_dataprivacy_bulk_approve_data_requests'),
(NULL, 2, 'tool_dataprivacy_deny_data_request'),
(NULL, 2, 'tool_dataprivacy_bulk_deny_data_requests'),
(NULL, 2, 'tool_dataprivacy_get_users'),
(NULL, 2, 'tool_dataprivacy_create_purpose_form'),
(NULL, 2, 'tool_dataprivacy_create_category_form'),
(NULL, 2, 'tool_dataprivacy_delete_purpose'),
(NULL, 2, 'tool_dataprivacy_delete_category'),
(NULL, 2, 'tool_dataprivacy_set_contextlevel_form'),
(NULL, 2, 'tool_dataprivacy_set_context_form'),
(NULL, 2, 'tool_dataprivacy_tree_extra_branches'),
(NULL, 2, 'tool_dataprivacy_confirm_contexts_for_deletion'),
(NULL, 2, 'tool_dataprivacy_set_context_defaults'),
(NULL, 2, 'tool_dataprivacy_get_category_options'),
(NULL, 2, 'tool_dataprivacy_get_purpose_options'),
(NULL, 2, 'tool_dataprivacy_get_activity_options'),
(NULL, 2, 'tool_lp_data_for_competency_frameworks_manage_page'),
(NULL, 2, 'tool_lp_data_for_competency_summary'),
(NULL, 2, 'tool_lp_data_for_competencies_manage_page'),
(NULL, 2, 'tool_lp_list_courses_using_competency'),
(NULL, 2, 'tool_lp_data_for_course_competencies_page'),
(NULL, 2, 'tool_lp_data_for_template_competencies_page'),
(NULL, 2, 'tool_lp_data_for_templates_manage_page'),
(NULL, 2, 'tool_lp_data_for_plans_page'),
(NULL, 2, 'tool_lp_data_for_plan_page'),
(NULL, 2, 'tool_lp_data_for_related_competencies_section'),
(NULL, 2, 'tool_lp_search_users'),
(NULL, 2, 'tool_lp_search_cohorts'),
(NULL, 2, 'tool_lp_data_for_user_evidence_list_page'),
(NULL, 2, 'tool_lp_data_for_user_evidence_page'),
(NULL, 2, 'tool_lp_data_for_user_competency_summary'),
(NULL, 2, 'tool_lp_data_for_user_competency_summary_in_plan'),
(NULL, 2, 'tool_lp_data_for_user_competency_summary_in_course'),
(NULL, 2, 'tool_mobile_get_plugins_supporting_mobile'),
(NULL, 2, 'tool_mobile_get_public_config'),
(NULL, 2, 'tool_mobile_get_config'),
(NULL, 2, 'tool_mobile_get_autologin_key'),
(NULL, 2, 'tool_mobile_get_content'),
(NULL, 2, 'tool_mobile_call_external_functions'),
(NULL, 2, 'tool_mobile_validate_subscription_key'),
(NULL, 2, 'tool_mobile_get_tokens_for_qr_login'),
(NULL, 2, 'tool_moodlenet_verify_webfinger'),
(NULL, 2, 'tool_moodlenet_search_courses'),
(NULL, 2, 'tool_policy_get_policy_version'),
(NULL, 2, 'tool_policy_submit_accept_on_behalf'),
(NULL, 2, 'tool_templatelibrary_list_templates'),
(NULL, 2, 'tool_templatelibrary_load_canonical_template'),
(NULL, 2, 'tool_usertours_fetch_and_start_tour'),
(NULL, 2, 'tool_usertours_step_shown'),
(NULL, 2, 'tool_usertours_complete_tour'),
(NULL, 2, 'tool_usertours_reset_tour'),
(NULL, 2, 'tool_xmldb_invoke_move_action'),
(NULL, 2, 'paygw_paypal_get_config_for_js'),
(NULL, 2, 'paygw_paypal_create_transaction_complete'),
(NULL, 2, 'quizaccess_seb_validate_quiz_keys'),
(NULL, 2, 'tiny_autosave_resume_session'),
(NULL, 2, 'tiny_autosave_reset_session'),
(NULL, 2, 'tiny_autosave_update_session'),
(NULL, 2, 'tiny_equation_filter');

/* Add Hook webservice token. */
DELETE FROM mdl_external_tokens WHERE id = 1;
INSERT INTO mdl_external_tokens VALUES
(1, '${HOOK_MOODLE_WEBSERVICE_TOKEN}', '${HOOK_MOODLE_WEBSERVICE_PRIVATE_TOKEN}', 0, 2, 2, NULL, 1, 2, NULL, 0, UNIX_TIMESTAMP(), NULL);

/* Add custom profile fields matching OULAD student_info table columns. */
DELETE FROM mdl_user_info_field;
INSERT INTO mdl_user_info_field VALUES
(NULL, 'gender', 'Gender', 'text', '<p dir="ltr" style="text-align: left;">Gender.<br></p>', 1, 1, 1, 0, 0, 2, 0, 1, "", 0, 30, 2048, 0, NULL, NULL),
(NULL, 'region', 'Region', 'text', '<p dir="ltr" style="text-align: left;">Geographic region.<br></p>', 1, 1, 1, 0, 0, 2, 0, 1, "", 0, 30, 2048, 0, NULL, NULL),
(NULL, 'highest_education', 'Highest education', 'text', '<p dir="ltr" style="text-align: left;">Highest education level.<br></p>', 1, 1, 1, 0, 0, 2, 0, 1, "", 0, 30, 2048, 0, NULL, NULL),
(NULL, 'imd_band', 'Index of Multiple Depravation band', 'text', '<p dir="ltr" style="text-align: left;">Index of Multiple Depravation band.<br></p>', 1, 1, 1, 0, 0, 2, 0, 1, "", 0, 30, 2048, 0, NULL, NULL),
(NULL, 'age_band', 'Age band', 'text', '<p dir="ltr" style="text-align: left;">Age band.<br></p>', 1, 1, 1, 0, 0, 2, 0, 1, "", 0, 30, 2048, 0, NULL, NULL),
(NULL, 'num_of_prev_attempts', 'Number of previous attempts', 'text', '<p dir="ltr" style="text-align: left;">Number of previous attempts.<br></p>', 1, 1, 1, 0, 0, 2, 0, 1, "", 0, 30, 2048, 0, NULL, NULL),
(NULL, 'studied_credits', 'Total number of credits', 'text', '<p dir="ltr" style="text-align: left;">Total number of credits.<br></p>', 1, 1, 1, 0, 0, 2, 0, 1, "", 0, 30, 2048, 0, NULL, NULL),
(NULL, 'disability', 'Disability', 'text', '<p dir="ltr" style="text-align: left;">Disability.<br></p>', 1, 1, 1, 0, 0, 2, 0, 1, "", 0, 30, 2048, 0, NULL, NULL),
(NULL, 'final_result', 'Final result', 'text', '<p dir="ltr" style="text-align: left;">Final result.<br></p>', 1, 1, 1, 0, 0, 2, 0, 1, "", 0, 30, 2048, 0, NULL, NULL);

COMMIT;
EOF
